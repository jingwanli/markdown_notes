### Linux系统启动详解

1. BIOS :进行自检
2. MBR : Boot Code 
3. 执行引导程序 GRUB :最主要的作用是加载内核
4. 加载内核 :加载内核后,操作系统的底层就已经启动了
5. 执行init : 进程id是1
6. runlevel : init根据当前定义的默认的运行级别去启动相关的服务和程序

> BIOS

- Basic Input Output System 基本输入输出系统, 一般保存在主板上的BIOS芯片中.
- 计算机启动的时候第一个运行的就是BIOS,  BIOS负责检查硬件并且查找可启动设备(可启动设备指的是有引导信息)
- 可启动设备在BIOS设置中进行定义(定义顺序): 如USB, CDROM,  HD(一般第一个CDROM, 然后是USB, 然后是HD)

> MBR (引导代码)
>
> 512字节 (使用bios的一般都是mbr,如果底层是efi, 上层就支持GPT引导格式)

- BIOS找到可启动设备后执行其引导代码(通过第一个扇区或者前512字节的最后2字节是55,aa来识别)
- 引导代码为MBR的前446字节(引导操作系统)

> GRUB (引导程序,因为MBR很小,所以要去找真正的引导程序)

-  GRUB是现在Linux使用的主流引导程序

- 可以用来引导现在几乎所有的操作系统

- Grub的相关文件保存在/boot/grub目录中 (与启动相关的都保存在root里面)

- Grub的配置文件为: /boot/grub/grub.conf

  Grub目录中

  - stage1 是当前硬盘上MBR的镜像(MBR不存在与任意一个文件系统中,就是硬盘开始的512字节) 

  -  stage1会去引导stage1_5(用于添加对某种文件系统的支持,相当于驱动)

  - 加载stage2(引导程序)

  - default=0 //采用第一组引导配置信息   

     timeout=3 //表示在开机的页面上会停几秒

    一个操作系统的引导配置信息,以title开头,有多个操作系统的话,有多个配置

  - splashimage 引导的欢迎界面

  - title后面是真正的引导程序

    - root(hd0,1) //定义操作系统所在的分区,此处分区的表示方法是grub的方式. hd代表硬盘,0代表第一块硬盘,1代表第二块硬盘

      逗号后代表此硬盘的哪一个分区(从0开始)

    - kernel  /vmlinuz-….: 内核文件 后面ro …是给内核传递的参数(以只读的形式去挂载根分区+ 根分区的位置 + 一些参数)

    - initrd —— >initramfs(centos6以后)

> KERNEL

- MBR的引导代码将负责找到并加载Linux内核
- Linux内核保存在 /boot/vmlinuz-2.6.32-279.el6.i686
- 一般还会加载内核模块打包文件: /boot/initramfs-2.6.32-279.el6.i686.img
- Linux为了保持kernel的精简,将一些不常用的驱动,功能编译成为模块, 在需要的时候动态加载, 而这些模块被打包保存为一个initramfs文件
- 早期版本Linux使用initrd文件, initramfs是initrd的替代优化版本,比initrd更加节省空间,更加灵活
- 命令dmesg可以查看本次启动时内核的输出信息(也可以通过查看文件: /var/log/dmesg)

> INIT

- init是Linux系统中运行的第一个进程(所有进程的父进程,会一直存在直到操作系统关机)
- 调用/etc/rc.d/rc.sysinit(脚本)负责对系统进行初始化,挂载文件系统,并且根据运行级别启动相应服务
- Linux的运行级别:runlevel
  - 0    关机
  - 1    单用户模式
  - 2    不带网络的多用户模式
  - 3    多用户模式
  - 4    未使用
  - 5    XII图形化模式
  - 6    重新启动 
    - 用的比较多的是3和5.(3没有图形界面,3,5只有有无图形界面的区别)
  - 可以通过/etc/inittab配置文件修改默认的运行级别(红帽将配置文件分开保存了, 保存在inittab和 /etc/init中)
  - 每个级别对应的启动服务保存在/etc/rc.d/rc[0123456].d中
  - 命令runlevel可显示当前及上一个运行级别
  - 命令init可用以改变当前运行级别 

### 单用户修改ROOT密码

root用户忘记密码,只有进入单用户模式才可以改(启动时按上下键让系统停在启动那里)

1. 为内核传递参数"1" 或者 "single" 可系统进入单用户模式
2. 单用户模式下不启动任何服务
3. 单用户模式直接以root用户登陆,并且不需要密码
4. 可以使用passwd修改root密码

### 配置GRUB加密

防止任何人只要可以接近Linux就可以修改密码

- 通过在grub.conf中的启动配置中加入如下参数,即可对grub进行加密

- 加密后的密码可以通过grub-md5-crypt生成

  如果此密码也忘记了,只能把硬盘卸下来,挂载到另一个机器上,将硬盘的根分区(启动文件所在的分区)挂载

  ​